.MODEL SMALL
;.286
.STACK 100
.DATA      
FILE   DB  'FILE$'
HELP   DB  'HELP$'
    
MENU   DB  'OPEN$'
       DB  'NEW $'
       DB  'SAVE$'
       DB  'EXIT$' 
       
BUFFER DB  1000 DUP(' ') 

ACTF   DW  0          
ABT    DB  'ABOUT$'
ABTMSG DB  'VERSION 1.0$'
FLAG   DB   ?
X      DB   ?
Y      DB   ? 
FNAMES DB  'WRITE FILE NAME IN BOX'
LIST LABEL BYTE
MXNLEN DB  30
ACTLEN DB  ?
FNAME  DB  31 DUP(?)  
    
MAXNLEN DW  47
FILEHAND DW   ?
OPENMSG  DB '***OPEN ERROR***$'
READMSG  DB '***READ ERROR***$'
WFILEN   DB 'YOU DID NOT ENTER FILE NAME!$'
ROW      DB ?  
COL      DB ?
ENDCODE  DB 00   
BUFF     DB 48 DUP(' ')

.CODE 
  
MAIN PROC FAR
    
    MOV AX,@DATA
    MOV DS,AX
    MOV ES,AX
    CALL DRAW
    A3:
    MOV AX,0600H 
    MOV BH,00
    MOV CX,0000
    MOV DX,184FH
    INT 10H 
    MOV AX,02H
    INT 33H
    MOV AX,4C00H
    INT 21H
MAIN ENDP

DRAWMIDDLE PROC NEAR
    PUSHA               
    MOV AX,0600H
    MOV BH,70H
    MOV CH,6
    MOV CL,4
    MOV DH,21
    MOV DL,49
    INT 10H 
    POPA
    RET
DRAWMIDDLE ENDP 

DRAW3 PROC NEAR
    PUSHA 
    MOV AX,0600H
    MOV BH,40
    MOV CH,5
    MOV CL,3
    MOV DH,5
    MOV DL,50
    INT 10H 
    POPA
    RET
DRAW3 ENDP   


DRAW PROC NEAR
    PUSHA
    MOV AX,0600H
    MOV BH,40
    MOV CH,2
    MOV CL,3
    MOV DH,22
    MOV DL,50
    INT 10H 
    MOV AX,0600H
    MOV BH,71H
    MOV CH,3
    MOV CL,4
    MOV DH,4
    MOV DL,49
    INT 10H
    
    CALL DRAWMIDDLE 
    MOV AH,02H
    MOV BH,00
    MOV DH,4
    MOV DL,5
    INT 10H
    
    MOV AH,09H
    LEA DX,FILE
    INT 21H 
    MOV AH,02H
    MOV BH,00
    MOV DH,4
    MOV DL,12
    INT 10H
    MOV AH,09H
    LEA DX,HELP
    INT 21H
    MOV AX,0000H
    INT 33H
    MOV AX,01H
    INT 33H
    
    A2:
    MOV AX,03H
    INT 33H
    CMP BX,1
    JE ZZ
    JMP A2
    ZZ:
    SHR DX,03
    SHR CX,03 
    CALL DRAW2
    JMP A2 
    
    POPA
    RET
DRAW ENDP 


DRAW2 PROC NEAR
PUSHA 
 
 CMP DX,04 ;FIRST ROW SELECTED
 JE  B1
 CMP DX,05 ;ABOUT or OPEN  SELECTED
 JE  B5 
 CMP DX,06 ;NEW SELECTED
 JE  B6
 CMP DX,07 ;SAVE IS SELECTED
 JE  B7 
 CMP DX,08  ;EXIT IS SELECTED
 JE  B8
 
 JMP B2
 B1:
 CMP CX,5
 JL  B2   ; LESS THEN FIVE OUT OF BOUNDARY
 CMP CX,8
 JLE B3
 CMP CX,13
 JGE B4  ;HELP IS SELECTED  
 JMP B2
 B4:  
 MOV FLAG,2
 CALL DRAWMIDDLE 
 CALL DRAW3
 MOV AX,1300H
 MOV BH,00
 MOV BL,71H
 LEA BP,ABT
 MOV CX,5 
 MOV DH,5
 MOV DL,13
 INT 10H
 JMP B2   
;----FILE IS SELECTED----- 
 B3:    
 MOV FLAG,1
 CALL DRAWMIDDLE 
 CALL DRAW3
 MOV AX,1300H
 MOV BH,00
 MOV BL,71H
 LEA BP,MENU
 MOV CX,4 
 MOV DH,5
 MOV DL,6
 C30:
 INT 10H
 ADD BP,5
 INC DH 
 CMP DH,9
 JNE C30 
 JMP B2
;---------------------------------- 
 B5:
 CMP FLAG,2
 JE B9
 CMP FLAG,1
 JE B10
 JMP B2
 B9:
 MOV AX,1300H
 MOV BH,00
 MOV BL,70H
 LEA BP,ABTMSG
 MOV CX,11 
 MOV DH,10
 MOV DL,10
 INT 10H      
 JMP B2         
 B10: 
 CALL INPUTFILE
 JMP B2
 B6:   
 CALL NEWFILE 
 JMP B2 
 B7:
 CALL SAVEFILE
 JMP  B2
 B8:
 JMP A3  
 B2:
POPA 
RET
DRAW2 ENDP

  
SAVEFILE PROC NEAR
    PUSHA
    CALL GETFILENAME
    CMP  FLAG,3 ;INPUT FILE
    JMP  F1
    CMP FLAG,4  ;OUTPUT FILE
    JE F2
    JMP F3    
    F1:
    CALL OPERATEINPUT
    JMP F3
    F2: 
    CALL OPERATEOUTPUT
     
    JMP F3
    
    F3:
    POPA
    RET
SAVEFILE ENDP 

OPERATEINPUT PROC NEAR
    PUSHA
    POPA
    RET
OPERATEINPUT ENDP

OPERATEOUTPUT PROC NEAR
    PUSHA
    POPA
    RET
OPERATEOUTPUT ENDP
 
 
;-------------------------------------
;PROCESS INPUT FILE AND DISPLAY

INPUTFILE PROC NEAR
     PUSHA
 CALL GETFILENAME  
 CALL DRAWMIDDLE 
 CALL DRAW3
 MOV  FLAG,3
 MOV  COL,10
 MOV  ROW,6
 
    CALL OPEN
    CMP  ENDCODE,00
    JNE A90
   
    A201:
    CALL READ
    CMP  ENDCODE,00
    JNZ  A801
    
    MOV BUFF[48],'$'
    CALL DISPLAY
;--------EMPTY BUFFER----------
    MOV BX,48 
    A444:
    MOV BUFF[BX],' '
    DEC BX
    JNZ A444  
;-------------------------------    
    JMP A201
    A801:
    MOV AH,3EH
    MOV BX,FILEHAND
    INT 21H
    A90: 
 POPA
 RET
INPUTFILE ENDP

OPEN PROC NEAR
    PUSHA
    MOV AH,3DH
    MOV AL,00
    LEA DX,FNAME
    INT 21H
    JC B20
    MOV FILEHAND,AX
    JMP B90
    B20:
    MOV AH,02H
    MOV DH,10
    MOV DL,10
    INT 10H
    MOV AH,09H
    LEA DX,OPENMSG
    INT 21H
    MOV ENDCODE,01
    B90: 
    POPA
    RET
OPEN ENDP

READ PROC NEAR
    
    MOV AH,3FH
    MOV BX,FILEHAND
    MOV CX,MAXNLEN
    LEA DX,BUFF
    INT 21H
    JC  C20
    CMP AX,00
    JE  C305
    CMP BUFF,1AH
    JE C305
    JMP C90
;--------READ ERROR-----------
    C20:
    MOV AH,02H
    MOV DH,10
    MOV DL,10
    INT 10H
    MOV AH,09H
    LEA DX,READMSG
    INT 21H
    C305:
    MOV  ENDCODE,01
    C90:
    RET
READ ENDP

DISPLAY PROC NEAR
     PUSHA
    MOV AX,0200H
    MOV DH,ROW
    MOV DL,10
    INT 10H 
    MOV AH,09H
    LEA DX,BUFF
    INT 21H
    CMP ROW,22
    JAE D80
    INC ROW
    JMP D90
    D80:
    CALL DRAWMIDDLE 
    CALL DRAW3 
    MOV  ROW,6
    D90:
    POPA
    RET 
DISPLAY ENDP

;-----------------------------------
; CREATE NEW FILE AND STORE INFORMATION
 
NEWFILE PROC NEAR
    PUSHA 
    CALL DRAWMIDDLE 
    CALL DRAW3
    MOV  FLAG,4 
    
    G5:
    MOV  X,4
    MOV  Y,6 
    G1:
    CALL SETCUSOR 
    MOV AH,01H
    INT 21H 
    
    MOV BX,ACTF
    MOV BUFFER[BX],AL
  
    CMP AL,0DH
    JE  XYZ
    CMP AL,00H
    JG  PP 

   XYZ:
    MOV AX,000
    MOV AL,47
    SUB AL,X
    ADD ACTF,AX  
    MOV X,4 ;INITIAL COLUMN
    INC Y 
    CMP Y,21 ;TERMINATION CONDITION OF WRITING
    JLE G1 
   JMP G10
      
   PP: 
    INC X
    CMP X,50
    JE  XYZ  ;NEW ROW 
    JMP G1 
  
  G10:  
    POPA
    RET
NEWFILE ENDP


;----INPUT FILE NAME------ 


GETFILENAME PROC NEAR
 PUSHA

 CALL DRAWMIDDLE 
 CALL DRAW3
 
 MOV AX,1300H
 MOV BH,00
 MOV BL,70H
 LEA BP,FNAMES
 MOV CX,22 
 MOV DH,7
 MOV DL,7
 INT 10H 

 MOV AX,0600H
 MOV BH,0E0H 
 MOV CH,9
 MOV CL,6
 MOV DH,10
 MOV DL,36 
 INT 10H 
 
 MOV AH,02H
 MOV BH,00
 MOV DH,9
 MOV DL,7
 INT 10H 

;GETTING FILE  NAME AND ADDING DIRECTORY

 MOV AH,0AH
 LEA DX,LIST
 INT 21H 
 CMP ACTLEN,00
 JE SSS
 
 MOV CX,0000
 MOV CL,ACTLEN
 
 MOV BX,CX 
 ADD BX,03
 MOV FNAME[BX],00H
 DEC BX
 J1:
 MOV AL,FNAME[BX-3]
 MOV FNAME[BX],AL
 DEC BX
 JNZ J1
 
 MOV FNAME[0],'C'
 MOV FNAME[1],':'
 MOV FNAME[2],'\'
 JMP DAAS
   SSS:        
    MOV AX,0200H
    MOV DL,10
    MOV DH,15
    INT 10H
    
    MOV AX,0900H
    LEA DX,WFILEN
    INT 21H
 DAAS:   
    POPA
    RET
GETFILENAME ENDP

SETCUSOR PROC NEAR
    PUSHA 
    MOV AX,0200H
    MOV DL,X
    MOV DH,Y
    INT 10H
    POPA
    RET
SETCUSOR ENDP

END MAIN
